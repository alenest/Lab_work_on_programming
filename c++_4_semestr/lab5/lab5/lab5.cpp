#include <iostream>
#include <list>
#include <string>
#include <algorithm>
#include <windows.h> // Для работы с русским языком в Windows

using namespace std;

// Структура для хранения данных студента
struct Студент {
    string фамилия;
    int математика;
    int информатика;
    int физика;

    Студент(const string& фамилия_студента, int балл_математика, int балл_информатика, int балл_физика)
        : фамилия(фамилия_студента),
        математика(балл_математика),
        информатика(балл_информатика),
        физика(балл_физика) {}
};

class ПроверкаОднойЧетверки {
public:
    bool operator()(const Студент& студент) const {
        int количество_четверок = 0;
        if (студент.математика == 4) количество_четверок++;
        if (студент.информатика == 4) количество_четверок++;
        if (студент.физика == 4) количество_четверок++;
        return количество_четверок == 1;
    }
};

int ввестиОценку(const string& предмет) {
    int оценка;
    while (true) {
        cout << "Введите оценку по " << предмет << " (от 2 до 5): ";
        cin >> оценка;

        if (cin.fail() || оценка < 2 || оценка > 5) {
            cin.clear();
            // Альтернатива numeric_limits - очистка до конца строки
            while (cin.get() != '\n') continue;
            cout << "Некорректный ввод! Оценка должна быть целым числом от 2 до 5." << endl;
        }
        else {
            // Очистка оставшихся символов во входном буфере
            while (cin.get() != '\n') continue;
            return оценка;
        }
    }
}

void ввестиДанныеСтудентов(list<Студент>& список_студентов) {
    int количество;
    cout << "Сколько студентов нужно добавить? ";
    cin >> количество;
    while (cin.get() != '\n') continue; // Очистка буфера

    if (количество <= 0) {
        cout << "Количество студентов должно быть больше нуля!" << endl;
        return;
    }

    for (int i = 0; i < количество; ++i) {
        cout << "\nДанные студента №" << i + 1 << ":" << endl;

        string фамилия;
        cout << "Фамилия: ";
        getline(cin, фамилия);

        int математика = ввестиОценку("математике");
        int информатика = ввестиОценку("информатике");
        int физика = ввестиОценку("физике");

        список_студентов.emplace_back(фамилия, математика, информатика, физика);
    }
}

void показатьРезультаты(const list<Студент>& список_студентов) {
    int количество_с_одной_четверкой = 0;
    for (const auto& студент : список_студентов) {
        if (ПроверкаОднойЧетверки()(студент)) {
            количество_с_одной_четверкой++;
        }
    }

    cout << "\n=== Результаты анализа ===" << endl;
    cout << "Всего студентов в списке: " << список_студентов.size() << endl;
    cout << "Из них с одной четверкой: " << количество_с_одной_четверкой << endl;

    if (количество_с_одной_четверкой > 0) {
        cout << "\nСписок студентов с одной четверкой:" << endl;
        cout << "---------------------------------" << endl;

        for (const auto& студент : список_студентов) {
            if (ПроверкаОднойЧетверки()(студент)) {
                cout << "Фамилия: " << студент.фамилия << endl;
                cout << "Оценки: математика - " << студент.математика
                    << ", информатика - " << студент.информатика
                    << ", физика - " << студент.физика << endl;
                cout << "---------------------------------" << endl;
            }
        }
    }
}

void показатьМеню() {
    cout << "\n=== Главное меню ===" << endl;
    cout << "1. Ввести данные студентов" << endl;
    cout << "2. Показать результаты анализа" << endl;
    cout << "3. Выйти из программы" << endl;
    cout << "Выберите действие (1-3): ";
}

int main() {
    SetConsoleCP(1251);
    SetConsoleOutputCP(1251);

    list<Студент> студенты;
    int выбор;

    do {
        показатьМеню();
        cin >> выбор;
        while (cin.get() != '\n') continue; // Очистка буфера

        switch (выбор) {
        case 1:
            студенты.clear();
            ввестиДанныеСтудентов(студенты);
            break;
        case 2:
            if (студенты.empty()) {
                cout << "\nСписок студентов пуст! Сначала введите данные." << endl;
            }
            else {
                показатьРезультаты(студенты);
            }
            break;
        case 3:
            cout << "Завершение работы программы. До свидания!" << endl;
            break;
        default:
            cout << "Неизвестный пункт меню! Пожалуйста, выберите 1, 2 или 3." << endl;
        }
    } while (выбор != 3);

    return 0;
}